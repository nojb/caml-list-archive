Return-Path: <info@gerd-stolpmann.de>
X-Original-To: caml-list@sympa.inria.fr
Delivered-To: caml-list@sympa.inria.fr
Received: from mail2-relais-roc.national.inria.fr (mail2-relais-roc.national.inria.fr [192.134.164.83])
	by sympa.inria.fr (Postfix) with ESMTPS id B29887FCF0
	for <caml-list@sympa.inria.fr>; Fri, 10 Apr 2015 13:25:47 +0200 (CEST)
Received-SPF: None (mail2-smtp-roc.national.inria.fr: no sender
  authenticity information available from domain of
  info@gerd-stolpmann.de) identity=pra;
  client-ip=212.227.126.131;
  receiver=mail2-smtp-roc.national.inria.fr;
  envelope-from="info@gerd-stolpmann.de";
  x-sender="info@gerd-stolpmann.de";
  x-conformance=sidf_compatible
Received-SPF: None (mail2-smtp-roc.national.inria.fr: no sender
  authenticity information available from domain of
  info@gerd-stolpmann.de) identity=mailfrom;
  client-ip=212.227.126.131;
  receiver=mail2-smtp-roc.national.inria.fr;
  envelope-from="info@gerd-stolpmann.de";
  x-sender="info@gerd-stolpmann.de";
  x-conformance=sidf_compatible
Received-SPF: None (mail2-smtp-roc.national.inria.fr: no sender
  authenticity information available from domain of
  postmaster@mout.kundenserver.de) identity=helo;
  client-ip=212.227.126.131;
  receiver=mail2-smtp-roc.national.inria.fr;
  envelope-from="info@gerd-stolpmann.de";
  x-sender="postmaster@mout.kundenserver.de";
  x-conformance=sidf_compatible
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: A0A+AgD/sidVlIN+49RcgmY7PVyDFcMbBoYFAoFAOxEBAQEBAQEBEQEBAQEHCwsJEjCEIAEBAwEjMiQFCwtCAgJXBhMJiBkJAwm3eBMhbw2VKgEBAQEBBQIBH4osf4QxJSYHgi0MLxKBMwWGIIsuAYlAgR2FeIoEg0yCJRyBUm0BgkIBAQE
X-IPAS-Result: A0A+AgD/sidVlIN+49RcgmY7PVyDFcMbBoYFAoFAOxEBAQEBAQEBEQEBAQEHCwsJEjCEIAEBAwEjMiQFCwtCAgJXBhMJiBkJAwm3eBMhbw2VKgEBAQEBBQIBH4osf4QxJSYHgi0MLxKBMwWGIIsuAYlAgR2FeIoEg0yCJRyBUm0BgkIBAQE
X-IronPort-AV: E=Sophos;i="5.11,556,1422918000"; 
   d="asc'?scan'208";a="132548027"
Received: from mout.kundenserver.de ([212.227.126.131])
  by mail2-smtp-roc.national.inria.fr with ESMTP/TLS/DHE-RSA-AES256-SHA; 10 Apr 2015 13:25:30 +0200
Received: from office1.lan.sumadev.de ([178.4.18.152]) by
 mrelayeu.kundenserver.de (mreue002) with ESMTPSA (Nemesis) id
 0Lup4D-1ZO9Q62snx-01028M; Fri, 10 Apr 2015 13:25:27 +0200
Received: from [IPv6:fd54:fbcf:6598:7e::1001] (unknown [IPv6:fd54:fbcf:6598:7e::1001])
	by office1.lan.sumadev.de (Postfix) with ESMTPSA id CF809DC05D;
	Fri, 10 Apr 2015 13:25:26 +0200 (CEST)
Message-ID: <1428665122.22412.39.camel@e130.lan.sumadev.de>
From: Gerd Stolpmann <info@gerd-stolpmann.de>
To: Daniel =?ISO-8859-1?Q?B=FCnzli?= <daniel.buenzli@erratique.ch>
Cc: Dario Teixeira <dario.teixeira@nleyten.com>, caml-list@inria.fr
Date: Fri, 10 Apr 2015 13:25:22 +0200
In-Reply-To: <C55070AB7ACF493F95485F4D225B6DC9@erratique.ch>
References: <2f9c74beafcf41f3ab30324fb1ece739@nleyten.com>
	 <55257AAD.6030004@zoho.com> <5297cdaceccd6db2a60700bf686ccfb7@nleyten.com>
	 <1428576994.22412.21.camel@e130.lan.sumadev.de>
	 <d8a23c877189537c81524be5df2b4377@nleyten.com>
	 <46483E4AF51B46A3B3F91B3B5CFE8249@erratique.ch>
	 <1428597912.4056.107.camel@thinkpad.lan.sumadev.de>
	 <9CB3F43413964B9F93581B26AD6B391B@erratique.ch>
	 <1428618115.4451.6.camel@zotac>
	 <C55070AB7ACF493F95485F4D225B6DC9@erratique.ch>
Content-Type: multipart/signed; micalg="pgp-sha1"; protocol="application/pgp-signature";
	boundary="=-SPgELj/1Vaopwah8e7Om"
X-Mailer: Evolution 3.10.4-0ubuntu2 
Mime-Version: 1.0
X-Provags-ID:  V03:K0:6LtNPT0pWaqgJ7WEavQ2tdaebiBKaalqNWoaUX18A7IsJAemjHK
 SzaxOPQVWnbhz2weB1Z4SR8bfJEvka7r1MrIwVRrr2sacHz8QPE5IBUdHZLwuj5Oiq6ZXEd
 V3hQ2yig5XWvzYSmzWUHeeSQP4he4o09k9TCDjMOMnAAeF/pClJg0TpVfW5CDAdaOmsEbod
 lKf5h3JHxSTZCgYsVqppA==
X-UI-Out-Filterresults: notjunk:1;
Subject: Re: [Caml-list] META file standards for ppx extensions


--=-SPgELj/1Vaopwah8e7Om
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: quoted-printable

Am Freitag, den 10.04.2015, 01:06 +0200 schrieb Daniel B=C3=BCnzli:
> Le vendredi, 10 avril 2015 =C3=A0 00:21, Gerd Stolpmann a =C3=A9crit :
> > No - you'd need to parse the command and watch out for -pp and -ppx
> > options.
>=20
> [=E2=80=A6]
> > I think the -ppx option is ignored by ocamlc if there is no module
> > source, so ocamlfind doesn't care about it.
>=20
> That seems quite brittle and unprecise=20

No, it is well-defined.

> and are things that get in the way/you have to consider when you need to =
debug build systems.

Why is it in the way? In a build system you compile normally module by
module, and separate linking out, but only because you can then specify
the options module by module, or by linking situation. However, ocamlc
already offers a superset of this, and why should ocamlfind restrict
that? It has always been the philosophy of findlib that it supports
everything ocamlc does, and in the same way, i.e. you can turn

ocamlc <options>

always into

ocamlfind ocamlc <options>

only that you have additional options. This philosophy is part of the
success story of findlib, and I won't change that.

> It seems to me that OCaml's build rules are already sufficiently complex =
so that the tool that is supposed to help us to manage them doesn't introdu=
ce more noise in the system.
>=20
> More specifically I think that most build system developers out there wou=
ld agree that having a clear ocamlfind sub-command that allows us to query =
the *exact* flags a package is supposed to provide us along the well define=
d phases: pre-processing, compilation and linking in the native and bytecod=
e dimensions would be of great help in general.=20=20

I think you are hunting a ghost animal. The ocamlfind wrapper is fast
enough that you can ignore it, and skipping it will only so minimally
speed up builds that it is not worth doing it.

If you want to develop something in this direction, I'd suggest a
different path, namely a new driver for the ocaml compilers that runs as
a server, and that communicates with the build system over a pipe. Also,
what we can talk about is that ocamlfind functionality is completely
available as library (as of now there is only package lookup in the
library, but not command construction). This would allow it to link it
into your build system, and simply call the functions directly. But as
said, alone this will not be the big accelerator, only in conjunction
with a true compile server.

Gerd

> Would you maybe consider implementing something along these lines ?=20=20
>=20
> Best,
>=20
> Daniel
>=20
>=20
>=20

--=20
------------------------------------------------------------
Gerd Stolpmann, Darmstadt, Germany    gerd@gerd-stolpmann.de
My OCaml site:          http://www.camlcity.org
Contact details:        http://www.camlcity.org/contact.html
Company homepage:       http://www.gerd-stolpmann.de
------------------------------------------------------------


--=-SPgELj/1Vaopwah8e7Om
Content-Type: application/pgp-signature; name="signature.asc"
Content-Description: This is a digitally signed message part
Content-Transfer-Encoding: 7bit

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAABAgAGBQJVJ7MiAAoJEAaM4b9ZLB5Tvc4H/jV8GouGBYgLmZ8OqBpOKM2x
WeQn1Qc/4WvCtpMlSOnS6j22SAXQtRSCGLOYKjxlanSvTc7RfLD/rCtq9mZH089d
ZKRmksB5lUbyMQKvNs7cdrAm6XECkMGg8eonKIl4F2nTP9x/RRNkj2xYEUz7B+7l
V8WCoPd+34nFI4DrIu34w6Rny+H1YbSd4TvDju7IEIIklNWCZzA/OVsACBowTh1G
AP/OWWkOpkdeZxnpNichZEbPM1bKpGOfALkkF6wKvtpXT4poyn1XxiMOGAVb9mEK
GsZ3fQ0rlSf675G7EnLg6GBS6QQAypQSNk968C43N++rZcxokE1cBhRbUeVcbd0=
=D6H4
-----END PGP SIGNATURE-----

--=-SPgELj/1Vaopwah8e7Om--

