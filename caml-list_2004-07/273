Received: (from majordomo@localhost) by pauillac.inria.fr (8.7.6/8.7.3) id QAA23404; Fri, 16 Jul 2004 16:47:04 +0200 (MET DST)
X-Authentication-Warning: pauillac.inria.fr: majordomo set sender to owner-caml-list@pauillac.inria.fr using -f
Received: from nez-perce.inria.fr (nez-perce.inria.fr [192.93.2.78]) by pauillac.inria.fr (8.7.6/8.7.3) with ESMTP id QAA23146 for <caml-list@pauillac.inria.fr>; Fri, 16 Jul 2004 16:47:03 +0200 (MET DST)
Received: from yquem.inria.fr (yquem.inria.fr [128.93.8.37])
	by nez-perce.inria.fr (8.12.10/8.12.10) with ESMTP id i6GEl2EV030431;
	Fri, 16 Jul 2004 16:47:02 +0200
Received: by yquem.inria.fr (Postfix, from userid 18180)
	id 0A773BC78; Fri, 16 Jul 2004 16:47:02 +0200 (CEST)
Date: Fri, 16 Jul 2004 16:47:02 +0200
From: Xavier Leroy <Xavier.Leroy@inria.fr>
To: Leo Rozenberg <leonidr@gmail.com>
Cc: caml-list@inria.fr
Subject: Re: [Caml-list] prelinking ocamlfind
Message-ID: <20040716144701.GB1905@yquem.inria.fr>
References: <e5d671d00407140753456984de@mail.gmail.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <e5d671d00407140753456984de@mail.gmail.com>
User-Agent: Mutt/1.3.28i
X-Miltered: at nez-perce with ID 40F7EA66.002 by Joe's j-chkmail (http://j-chkmail.ensmp.fr)!
X-Loop: caml-list@inria.fr
X-Spam: no; 0.00; caml-list:01 ocamlfind:01 3.07:01 modifies:01 ocamlfind:01 usr:01 3.07:01 mixed-mode:01 ocamlc:01 mixed-mode:01 ocamlc:01 nonetheless:01 linked:01 ocaml:01 ocaml:01 
Sender: owner-caml-list@pauillac.inria.fr
Precedence: bulk

> I have noticed an odd behavior, between 3.07 and 3.08.0 versions of
> ocaml. On otherwise identical systems of Fedora Core 1 distributions
> (which by default prelinks libraries and executables daily), the
> prelink command modifies ocamlfind built by 3.08 but not by 3.07.
> This was concluded by examining the prelink log (prelink.log), which
> is invoked with
> /usr/sbin/prelink -av -mR -q

I can't really explain the different behaviour between 3.07 and 3.08
(it seems to boil down to the fact that ocamlfind is linked with
different shared libraries in both cases, so maybe your two OCaml
installations were configured differently).

On a related not, I just wanted to mention that Fedora's prelinking
breaks mixed-mode executables generated by "ocamlc -custom", rendering
them unusable.  The reason is that prelinking removes the bytecode
part of these mixed-mode executables, just like "strip" does.

Fortunately, "ocamlc -custom" is no longer very useful since dynamic
loading of C libraries can be used instead (and produces a pure
bytecode executable that is left undisturbed by prelinking).

Nonetheless, some old Makefiles still contain "ocamlc -custom" where
"ocamlc" would suffice, and this can lead to problems with Fedora's
prelinking.  (Example: the "coqtop" command from the Coq proof assistant.)
Keep this in mind...

- Xavier Leroy

-------------------
To unsubscribe, mail caml-list-request@inria.fr Archives: http://caml.inria.fr
Bug reports: http://caml.inria.fr/bin/caml-bugs FAQ: http://caml.inria.fr/FAQ/
Beginner's list: http://groups.yahoo.com/group/ocaml_beginners

