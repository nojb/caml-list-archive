Received: (from majordomo@localhost) by pauillac.inria.fr (8.7.6/8.7.3) id QAA08452; Sat, 17 Jul 2004 16:57:54 +0200 (MET DST)
X-Authentication-Warning: pauillac.inria.fr: majordomo set sender to owner-caml-list@pauillac.inria.fr using -f
Received: from concorde.inria.fr (concorde.inria.fr [192.93.2.39]) by pauillac.inria.fr (8.7.6/8.7.3) with ESMTP id QAA08796 for <caml-list@pauillac.inria.fr>; Sat, 17 Jul 2004 16:57:53 +0200 (MET DST)
X-SPAM-Warning: Sending machine is listed in blackholes.five-ten-sg.com
Received: from mwinf0901.wanadoo.fr (smtp9.wanadoo.fr [193.252.22.22])
	by concorde.inria.fr (8.12.10/8.12.10) with ESMTP id i6HEvqSH014211;
	Sat, 17 Jul 2004 16:57:52 +0200
Received: from pegasos (AStrasbourg-251-1-17-195.w82-126.abo.wanadoo.fr [82.126.207.195])
	by mwinf0901.wanadoo.fr (SMTP Server) with ESMTP
	id 1DFEF18001D4; Sat, 17 Jul 2004 16:57:52 +0200 (CEST)
Received: from luther by pegasos with local (Exim 4.34)
	id 1Blqjy-0006e7-Bt; Sat, 17 Jul 2004 17:04:42 +0200
Date: Sat, 17 Jul 2004 17:04:42 +0200
To: Xavier Leroy <Xavier.Leroy@inria.fr>
Cc: Leo Rozenberg <leonidr@gmail.com>, caml-list@inria.fr
Subject: Re: [Caml-list] prelinking ocamlfind
Message-ID: <20040717150442.GA25514@pegasos>
References: <e5d671d00407140753456984de@mail.gmail.com> <20040716144701.GB1905@yquem.inria.fr>
Mime-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Disposition: inline
In-Reply-To: <20040716144701.GB1905@yquem.inria.fr>
User-Agent: Mutt/1.5.6i
From: Sven Luther <sven.luther@wanadoo.fr>
X-Miltered: at concorde with ID 40F93E70.000 by Joe's j-chkmail (http://j-chkmail.ensmp.fr)!
X-Loop: caml-list@inria.fr
X-Spam: no; 0.00; caml-list:01 ocamlfind:01 sven:01 luther:01 sven:01 luther:01 2004:99 3.07:01 modifies:01 ocamlfind:01 usr:01 3.07:01 mixed-mode:01 ocamlc:01 mixed-mode:01 
Sender: owner-caml-list@pauillac.inria.fr
Precedence: bulk

On Fri, Jul 16, 2004 at 04:47:02PM +0200, Xavier Leroy wrote:
> > I have noticed an odd behavior, between 3.07 and 3.08.0 versions of
> > ocaml. On otherwise identical systems of Fedora Core 1 distributions
> > (which by default prelinks libraries and executables daily), the
> > prelink command modifies ocamlfind built by 3.08 but not by 3.07.
> > This was concluded by examining the prelink log (prelink.log), which
> > is invoked with
> > /usr/sbin/prelink -av -mR -q
> 
> I can't really explain the different behaviour between 3.07 and 3.08
> (it seems to boil down to the fact that ocamlfind is linked with
> different shared libraries in both cases, so maybe your two OCaml
> installations were configured differently).
> 
> On a related not, I just wanted to mention that Fedora's prelinking
> breaks mixed-mode executables generated by "ocamlc -custom", rendering
> them unusable.  The reason is that prelinking removes the bytecode
> part of these mixed-mode executables, just like "strip" does.

Xavier, i have been told that this probably happens because we use a elf
section that is normally strippable. It could be solved by using a
special elf section specialized to our need (maybe one named bytecode or
something), then at least strip and possibly the prelink stuff, would
not remove it as it does not.

Now, i am not elf knowledgeable, but i suppose this may break backward
compatibility of ocaml code or something. See here for the later debian
bug report, but there was some other discussion of this earlier i don't
remember :

http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=256900

Friendly,

Sven Luther

-------------------
To unsubscribe, mail caml-list-request@inria.fr Archives: http://caml.inria.fr
Bug reports: http://caml.inria.fr/bin/caml-bugs FAQ: http://caml.inria.fr/FAQ/
Beginner's list: http://groups.yahoo.com/group/ocaml_beginners

