Return-Path: <kip.macy@gmail.com>
X-Spam-Checker-Version: SpamAssassin 3.1.3 (2006-06-01) on yquem.inria.fr
X-Spam-Level: *
X-Spam-Status: No, score=1.4 required=5.0 tests=AWL,DNS_FROM_RFC_ABUSE,
	SPF_NEUTRAL autolearn=disabled version=3.1.3
X-Original-To: caml-list@yquem.inria.fr
Delivered-To: caml-list@yquem.inria.fr
Received: from discorde.inria.fr (discorde.inria.fr [192.93.2.38])
	by yquem.inria.fr (Postfix) with ESMTP id 49764BC6A
	for <caml-list@yquem.inria.fr>; Sun,  8 Oct 2006 01:48:23 +0200 (CEST)
Received: from nf-out-0910.google.com (nf-out-0910.google.com [64.233.182.187])
	by discorde.inria.fr (8.13.6/8.13.6) with ESMTP id k97NmIku027098
	for <caml-list@inria.fr>; Sun, 8 Oct 2006 01:48:23 +0200
Received: by nf-out-0910.google.com with SMTP id l36so1445935nfa
        for <caml-list@inria.fr>; Sat, 07 Oct 2006 16:48:18 -0700 (PDT)
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws;
        s=beta; d=gmail.com;
        h=received:message-id:date:from:to:subject:mime-version:content-type:content-transfer-encoding:content-disposition;
        b=phKFk2pKwQ/Fdee9Qqw9GQFzXszSLiHrfgiJs0b+TYYZOIz9fGJfMctqUWEW+bY7WaSa5RLv/PucvPmZPb5VSldNw3IEJxufIEa7IoxX8hu1lwLFmqsuclpoaOWasB6n5vDG6mBQ1G47wUBlB/gpMgSOhIBeqmgXwIKtQeDQBZI=
Received: by 10.82.111.8 with SMTP id j8mr303205buc;
        Sat, 07 Oct 2006 16:48:18 -0700 (PDT)
Received: by 10.82.191.20 with HTTP; Sat, 7 Oct 2006 16:48:18 -0700 (PDT)
Message-ID: <b1fa29170610071648s405f2fb2g4ed4090360390c8a@mail.gmail.com>
Date: Sat, 7 Oct 2006 16:48:18 -0700
From: "Kip Macy" <kip.macy@gmail.com>
To: Ocaml <caml-list@inria.fr>
Subject: bus error in ocamlopt.opt when doing "make opt.opt" on sparc64
MIME-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Content-Disposition: inline
X-j-chkmail-Score: MSGID : 45283CC2.000 on discorde : j-chkmail score : X : 0/20 1
X-Miltered: at discorde with ID 45283CC2.000 by Joe's j-chkmail (http://j-chkmail.ensmp.fr)!
X-Spam: no; 0.00; ocamlopt:01 aligned:01 ocamlrun:01 ocamlopt:01 -nostdlib:01 stdlib:01 utils:01 parsing:01 bytecomp:01 asmcomp:01 ocamldep:01 cmx:01 config:01 cmx:01 clflags:01 

It appears that init_atoms passes minmax_table a 4-byte aligned address.

../boot/ocamlrun ../ocamlopt -nostdlib -I ../stdlib -I ../utils -I
../parsing -I ../typing -I ../bytecomp -I ../asmcomp  -I ../driver -o
ocamldep.opt misc.cmx config.cmx clflags.cmx terminfo.cmx linenum.cmx
warnings.cmx location.cmx longident.cmx syntaxerr.cmx parser.cmx
lexer.cmx parse.cmx  depend.cmx ocamldep.cmx
cd camlp4; make opt.opt
set -e; for i in lib odyl camlp4 meta etc compile; do cd $i; make opt;
cd ..; done
cp odyl_config.ml odyl_config.ppo
../../ocamlcompopt.sh -warn-error A -I ../../otherlibs/dynlink -c
-impl odyl_config.ppo
Bus error (core dumped)
*** Error code 138

Stop in /shared/ocaml-3.09.3/camlp4/odyl.
*** Error code 1


%gdb ocamlopt.opt camlp4/odyl/ocamlopt.opt.core
GNU gdb 6.1.1 [FreeBSD]
Copyright 2004 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "sparc64-marcel-freebsd"...
Core was generated by `ocamlopt.opt'.
Program terminated with signal 10, Bus error.
Reading symbols from /lib/libm.so.4...done.
Loaded symbols for /lib/libm.so.4
Reading symbols from /lib/libc.so.7...done.
Loaded symbols for /lib/libc.so.7
Reading symbols from /libexec/ld-elf.so.1...done.
Loaded symbols for /libexec/ld-elf.so.1
#0  0x0000000000250780 in minmax_table ()
(gdb) bt
#0  0x0000000000250780 in minmax_table ()
#1  0x0000000000250848 in init_atoms ()
#2  0x0000000000250ad0 in caml_main ()
#3  0x000000000023ed6c in main ()
(gdb) x/i $pc
0x250780 <minmax_table>:        ldx  [ %o0 ], %g1
(gdb) p/x $o0
$2 = 0x353b84

