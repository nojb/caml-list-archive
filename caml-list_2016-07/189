Return-Path: <info@gerd-stolpmann.de>
X-Original-To: caml-list@sympa.inria.fr
Delivered-To: caml-list@sympa.inria.fr
Received: from mail2-relais-roc.national.inria.fr (mail2-relais-roc.national.inria.fr [192.134.164.83])
	by sympa.inria.fr (Postfix) with ESMTPS id 0EAE67EF5E
	for <caml-list@sympa.inria.fr>; Fri, 15 Jul 2016 16:47:21 +0200 (CEST)
IronPort-PHdr: 9a23:36UqRxb8TU5RSHSwxkGvLcn/LSx+4OfEezUN459isYplN5qZpcS9bnLW6fgltlLVR4KTs6sC0LuO9fy8EjNcqb+681k6OKRWUBEEjchE1ycBO+WiTXPBEfjxciYhF95DXlI2t1uyMExSBdqsLwaK+i760zceF13FOBZvIaytQ8iJ3pzxi7z5pMGbSj4LrQL1Wal1IhSyoFeZnegtqqwmFJwMzADUqGBDYeVcyDAgD1uSmxHh+pX4p8Y7oGx48sgs/M9YUKj8Y79wDfkBVGxnYCgJ45jQNBPKVheO631UcmQQnhdSDhKNuCr3VJ7qrir3sKxd2S+WMNf7V5g1Xy6j5uFlUkm7pj0AMmsW/Xvbwvdsi6ZDpRunoVQrwojaZ6maOeByO7jBetcCQGNHWIBdWnoSUcuHc4ITAr9Zbq5jpI7nqg5L9EPmCA==
Authentication-Results: mail2-smtp-roc.national.inria.fr; spf=None smtp.pra=info@gerd-stolpmann.de; spf=None smtp.mailfrom=info@gerd-stolpmann.de; spf=None smtp.helo=postmaster@mout.kundenserver.de
Received-SPF: None (mail2-smtp-roc.national.inria.fr: no sender
  authenticity information available from domain of
  info@gerd-stolpmann.de) identity=pra;
  client-ip=212.227.126.131;
  receiver=mail2-smtp-roc.national.inria.fr;
  envelope-from="info@gerd-stolpmann.de";
  x-sender="info@gerd-stolpmann.de";
  x-conformance=sidf_compatible
Received-SPF: None (mail2-smtp-roc.national.inria.fr: no sender
  authenticity information available from domain of
  info@gerd-stolpmann.de) identity=mailfrom;
  client-ip=212.227.126.131;
  receiver=mail2-smtp-roc.national.inria.fr;
  envelope-from="info@gerd-stolpmann.de";
  x-sender="info@gerd-stolpmann.de";
  x-conformance=sidf_compatible
Received-SPF: None (mail2-smtp-roc.national.inria.fr: no sender
  authenticity information available from domain of
  postmaster@mout.kundenserver.de) identity=helo;
  client-ip=212.227.126.131;
  receiver=mail2-smtp-roc.national.inria.fr;
  envelope-from="info@gerd-stolpmann.de";
  x-sender="postmaster@mout.kundenserver.de";
  x-conformance=sidf_compatible
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: A0DRAAAy94hXh4N+49RdhBR8uHKBeyKFeAKBLTkTAQEBAQEBAQERAQEBCA0JCSEvgjIEARIBghMBBVUkEAtGVwYTCYgrAQmyB2+NEQEBAQEBAQEBAQEBAQEBARQOhTKFRYQpI4I9C4MHBYgdkQSBOwKEVohIiUwEhWWQGyABgk+BWWwBhlIBAQE
X-IPAS-Result: A0DRAAAy94hXh4N+49RdhBR8uHKBeyKFeAKBLTkTAQEBAQEBAQERAQEBCA0JCSEvgjIEARIBghMBBVUkEAtGVwYTCYgrAQmyB2+NEQEBAQEBAQEBAQEBAQEBARQOhTKFRYQpI4I9C4MHBYgdkQSBOwKEVohIiUwEhWWQGyABgk+BWWwBhlIBAQE
X-IronPort-AV: E=Sophos;i="5.28,368,1464645600"; 
   d="asc'?scan'208";a="226813978"
Received: from mout.kundenserver.de ([212.227.126.131])
  by mail2-smtp-roc.national.inria.fr with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384; 15 Jul 2016 16:47:20 +0200
Received: from office1.lan.sumadev.de ([178.4.65.50]) by
 mrelayeu.kundenserver.de (mreue004) with ESMTPSA (Nemesis) id
 0LouWl-1arkRo2J1X-00gtTU; Fri, 15 Jul 2016 16:47:19 +0200
Received: from [192.168.65.10] (unknown [192.168.65.10])
	by office1.lan.sumadev.de (Postfix) with ESMTPSA id C35E7DC05D;
	Fri, 15 Jul 2016 16:47:18 +0200 (CEST)
Message-ID: <1468594034.25014.129.camel@e130.lan.sumadev.de>
From: Gerd Stolpmann <info@gerd-stolpmann.de>
To: =?ISO-8859-1?Q?S=E9bastien?= Hinderer <Sebastien.Hinderer@inria.fr>
Cc: caml-list@inria.fr
Date: Fri, 15 Jul 2016 16:47:14 +0200
In-Reply-To: <20160714192653.GA17159@pema>
References: <1468359569.25014.103.camel@e130.lan.sumadev.de>
	 <20160714192653.GA17159@pema>
Content-Type: multipart/signed; micalg="pgp-sha1"; protocol="application/pgp-signature";
	boundary="=-ZeUwyM4aRWiiXqQ2xVRm"
X-Mailer: Evolution 3.10.4-0ubuntu2 
Mime-Version: 1.0
X-Provags-ID: V03:K0:4/MXqz3k7jjc1akSYKPgh46/HoXWBrQinc571hpXnDvb448Q8Lu
 jG1Nt/jYxg91d4Fp1LAC8GbjjsRarlh35wlGs7D1TCz3lIZRvwNF3ckopOhw6jUG2LKiXRu
 UIUqjN+GR9G3sHzz3ldydrDZ3rG5Qp7BRC8GZ1zh4QL15sY/l5vh71qzpVYp00UHkSOhkJD
 Y1XRabN3g/mmMuaM0dbRw==
X-UI-Out-Filterresults: notjunk:1;V01:K0:EafJRaaIKDA=:YmlVDXFPRZs+em7Qc9QV4w
 GD79y3sKTygZkTPwsFrtlUKT4FmW5LK9jfVWyjQSMyJgDm5Z0u6D26qGI/zyqXm8oQ7jV0Z1n
 rCvcTgJg95WztZtHzqlYtwpHfTtysdX8MQlHuGMUpqVa7PSN835c3O7kBhsWsQ68/AauimGs4
 kboK0+OO2x6tlTOgCUhL+csOh37Op60IJxUSXn4FpUrIZbeAEQW+VAWRbwN1M0sTudz+oQUz5
 ygeFO1lJ6O2F9A0fix+8pcgw2PeHbAmgMdKECDYUsv9XmLLjKBOeOdnEdGUTUUyh41NJkKvu3
 PtzWTwZ3GM9y6wkU6QJRzHbnST18mcsz0w0dWyiIylcT2LnMdPSNfnxMF4YVUF7rUwlfcTqw3
 GRtkPc59iMGpELVGqmdHZzVrwPdV+NkUBy03fm3KquoKRdWdABiVbwwSX2TRQvZjsEPNtdnFf
 4SHJwRG/WdeN7b6gsseIQwZCsEv0FyzMELM5kTKvFNhydhec9p+JCq0cEHUB/uUQTM883T7iq
 OJAVvZAgleDrF6Lp9Z6wwYhPoYaqh4HtkomSSDaqqm6WiaAtwH1D+itcGM3kbOQDDmPCCeXsp
 HEznl8ye6+lXD29BuK1XSLe83GBjFY9UGCvCPE46WG3OfAFUtKRV2t4e6T0+0so8uTImOU/Jx
 l3l4x986g33fpNt7K6zPP4LMwYuNENtB2jDec6eNeSaMcNWgrpppnJEXSQ2CRRpgmjAQ=
Subject: Re: [Caml-list] ocamlnat


--=-ZeUwyM4aRWiiXqQ2xVRm
Content-Type: text/plain; charset="ISO-8859-15"
Content-Transfer-Encoding: quoted-printable

Am Donnerstag, den 14.07.2016, 21:26 +0200 schrieb S=E9bastien Hinderer:
> Hi Gerd,
>=20
> Gerd Stolpmann (2016/07/12 23:39 +0200):
> > Hi,
> >=20
> > I've tried to reactivate the ocamlnat tool that comes with OCaml but
> > isn't built (and even isn't buildable). This repo was tested against
> > 4.02.3:
> >=20
> > https://gitlab.camlcity.org/gerd/ocamlnat
> >=20
> > Since recently I'm quite interested in this, and would like to make it
> > fully working, including ocamlfind support. For my use case the
> > disadvantages of the ocamlnat approach (i.e. that it requires toolchain
> > support for dynlinking, and that the executable continuously grows) do
> > not matter - I really want it for interactive work, and not for
> > scripting.
>=20
> I just wanted to mention that ocamltest's "toplevel" builtin test runs a
> test-file in both the byte-code and the native toplevel.
>=20
> For some tests the results are a bit different in the two toplevels, but
> for most of them they are similar.

In deed, the native toplevel seems to run fine. So far I made the
following adjustments in my repo:

 - renamed the modules so that the same names as for the bytecode
   version are used (e.g. Opttoploop becomes just Toploop)
 - added the missing definitions so that the interfaces are
   identical to the bytecode version
 - now, findlib already worked when I loaded cmxs files instead
   of cma files
 - there was a bug that -linkall was not set when the cmxs files
   were on-the-fly generated
 - I also changed the error paths a little bit so that ocamlnat
   no longer crashes when a symbol isn't found. The error paths
   probably require more work.

Now you can do:

OCAMLFIND_CONF=3D/opt/opam-4.02/4.02.3/lib/findlib.conf ./ocamlnat
        OCaml version 4.02.3 - native toplevel

# #use "/home/gerd/pub/lib-findlib/src/findlib/topfind";;
- : unit =3D ()
Findlib has been successfully loaded. Additional directives:
  #require "package";;      to load a package
  #list;;                   to list the available packages
  #camlp4o;;                to load camlp4 (standard syntax)
  #camlp4r;;                to load camlp4 (revised syntax)
  #predicates "p,q,...";;   to set these predicates
  Topfind.reset();;         to force that packages will be reloaded
  #thread;;                 to enable threads

- : unit =3D ()
# #require "yojson";;
/opt/opam-4.02/4.02.3/lib/easy-format: added to search path
/opt/opam-4.02/4.02.3/lib/easy-format/easy_format.cmx: loaded
/opt/opam-4.02/4.02.3/lib/biniou: added to search path
/opt/opam-4.02/4.02.3/lib/biniou/biniou.cmxa: loaded
/opt/opam-4.02/4.02.3/lib/yojson: added to search path
/opt/opam-4.02/4.02.3/lib/yojson/yojson.cmx: loaded
# Yojson.version;;
- : string =3D "1.3.2"

(Using the "ocamlnat" branch of findlib.)

It is interesting that only very little work was needed to get there.
I'll test that more out in the next days, and I think there will be a PR
soon.

Gerd
--=20
------------------------------------------------------------
Gerd Stolpmann, Darmstadt, Germany    gerd@gerd-stolpmann.de
My OCaml site:          http://www.camlcity.org
Contact details:        http://www.camlcity.org/contact.html
Company homepage:       http://www.gerd-stolpmann.de
------------------------------------------------------------


--=-ZeUwyM4aRWiiXqQ2xVRm
Content-Type: application/pgp-signature; name="signature.asc"
Content-Description: This is a digitally signed message part
Content-Transfer-Encoding: 7bit

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAABAgAGBQJXiPdyAAoJEAaM4b9ZLB5TaA8H/1XosEQAMRGqnhIoGujWvgzQ
9fjXa/DK05ScVa8cGfPJzj6kk+Uto5opzI/2dFFsdhLTtMmxDFwQAInrV5VjretO
ejIqN1pCXN8SyGhpkPiH9wGO5AiedQm0eu0EeQckOeXJNsB6a2Od8UV42mZC1Sgr
HxEBLj4bCHZsjXGck5BLLL1N8lANbXFu8pA2wOe2tHfdxcsHxKYPYQAAYYYgQWwE
HsBgNjUok/pdzeGZXLnU1fqH5WxPS8cP7SycXVa7i9WvTHDf9wgkhZYMbhuGVJcp
2GZJu4lfXNRqYDgkIXAa6r90DcyWCA2/QhBWHM3gjute3Nbn+nYr7Oec22/NXmw=
=59ef
-----END PGP SIGNATURE-----

--=-ZeUwyM4aRWiiXqQ2xVRm--

