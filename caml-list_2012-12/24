Return-Path: <info@gerd-stolpmann.de>
X-Original-To: caml-list@sympa.inria.fr
Delivered-To: caml-list@sympa.inria.fr
Received: from mail1-relais-roc.national.inria.fr (mail1-relais-roc.national.inria.fr [192.134.164.82])
	by sympa.inria.fr (Postfix) with ESMTPS id 24AF67EE56
	for <caml-list@sympa.inria.fr>; Fri,  7 Dec 2012 16:33:08 +0100 (CET)
Received-SPF: None (mail1-smtp-roc.national.inria.fr: no sender
  authenticity information available from domain of
  info@gerd-stolpmann.de) identity=pra;
  client-ip=212.227.126.171;
  receiver=mail1-smtp-roc.national.inria.fr;
  envelope-from="info@gerd-stolpmann.de";
  x-sender="info@gerd-stolpmann.de";
  x-conformance=sidf_compatible
Received-SPF: None (mail1-smtp-roc.national.inria.fr: no sender
  authenticity information available from domain of
  info@gerd-stolpmann.de) identity=mailfrom;
  client-ip=212.227.126.171;
  receiver=mail1-smtp-roc.national.inria.fr;
  envelope-from="info@gerd-stolpmann.de";
  x-sender="info@gerd-stolpmann.de";
  x-conformance=sidf_compatible
Received-SPF: Pass (mail1-smtp-roc.national.inria.fr: domain of
  postmaster@moutng.kundenserver.de designates 212.227.126.171
  as permitted sender) identity=helo;
  client-ip=212.227.126.171;
  receiver=mail1-smtp-roc.national.inria.fr;
  envelope-from="info@gerd-stolpmann.de";
  x-sender="postmaster@moutng.kundenserver.de";
  x-conformance=sidf_compatible; x-record-type="v=spf1"
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: Ai4BADILwlDU436rk2dsb2JhbAAqGoY1uAEWDgEBAQEJCQsJFAMkgh4BAQEDAQEBASBLCwULCxoCERUCAicwBhMJEYdxCggtryWSWIEiix2BDoIigRMDjWSEboRPhE+NUQ
X-IronPort-AV: E=Sophos;i="4.84,239,1355094000"; 
   d="scan'208";a="185141979"
Received: from moutng.kundenserver.de ([212.227.126.171])
  by mail1-smtp-roc.national.inria.fr with ESMTP/TLS/RC4-SHA; 07 Dec 2012 16:32:58 +0100
Received: from office1.lan.sumadev.de (dslb-188-097-076-159.pools.arcor-ip.net [188.97.76.159])
	by mrelayeu.kundenserver.de (node=mreu3) with ESMTP (Nemesis)
	id 0MICba-1Tjjk70fE6-00478H; Fri, 07 Dec 2012 16:32:57 +0100
Received: from [192.168.5.106] (dslb-188-097-076-159.pools.arcor-ip.net [188.97.76.159])
	by office1.lan.sumadev.de (Postfix) with ESMTPSA id B45C2C00CF;
	Fri,  7 Dec 2012 16:32:56 +0100 (CET)
From: Gerd Stolpmann <info@gerd-stolpmann.de>
To: Sylvain Le Gall <sylvain@le-gall.net>
Cc: caml-list <caml-list@inria.fr>, godi-list <godi-list@ocaml-programming.de>
In-Reply-To: <CAOCAUGMbcXktGptBc9PcT8fV8iWX8gB3gZ=aZoqe=eN8SacB1Q@mail.gmail.com>
References: <1354845647.3169.30@samsung>
	 <CAOCAUGMbcXktGptBc9PcT8fV8iWX8gB3gZ=aZoqe=eN8SacB1Q@mail.gmail.com>
Content-Type: text/plain; charset="UTF-8"
Date: Fri, 07 Dec 2012 16:32:56 +0100
Message-ID: <1354894376.3042.161.camel@thinkpad>
Mime-Version: 1.0
X-Mailer: Evolution 2.28.3 
Content-Transfer-Encoding: quoted-printable
X-Provags-ID: V02:K0:UDDzVKu5CIBM2qb1zrxch9O9/JdJUx2TvUqc7TZ0GlH
 bORqkxdsXzSBpc+e7wRXwKud3dyU1V9Uma9xCBlV36pFQKsKVX
 tzMj2aoKqPU9jIkd3ya8D1BaMzRTT2Yui+9hLajZ00UdtCSl/6
 j0CBqXUbFDBKv/us+pRipA9DC+XLotcrLWwqq6K7QyFGyJ0Oxf
 OXXsASBd8qSj2hwAZZxUJrtzicF0j7E/Cg79jzOkYkrtr4Pls0
 6L++ULOpWFMgra0HF4d3E0qq88t/VxviSKGeOiHTXF9mT3SPou
 9NZabXIAUcn/B30fhSjhxOCkczuP7JT4XN/ML4y6VrJELajNnR
 B2X0tSBFtt9NIJOHPBCXtz+bucuOsO+8Y4DhKLVxB
Subject: [Caml-list] Re: [Godi-list] GODI imports OASIS

Am Freitag, den 07.12.2012, 09:32 +0100 schrieb Sylvain Le Gall:
> Hi
>=20
> Le 7 d=C3=A9c. 2012 03:00, "Gerd Stolpmann" <info@gerd-stolpmann.de> a
> =C3=A9crit :
> >
> > Hi list,
> >
> > the GODI project has now set up an experimental OASIS-DB import.
> This means that packages submitted to OASIS-DB appear as normal GODI
> packages in godi_console, and can be managed in the normal way.
> >
>=20
> This is a very good news. Let make it even better.
>=20
> > We are now importing nightly into a separate repository that needs
> to be activated. Find the instructions (and a number of FAQ) here:
> >
> > http://godi.camlcity.org/godi/oasis.html
> >
> > Remember that OASIS packages are not QA-checked, and as a result
> many packages still fail to build. This often has trivial reasons
> (like that the build is ok, but the documentation fails). I hope to
> hear your comments on this.
> >
> > Also, any comment on user experience is very welcome.
> >
>=20
> Some answer:
> - the OASIS package ignores the --destdir:
>=20
> There is an open bug for that=20
> https://forge.ocamlcore.org/tracker/index.php?func=3Ddetail&aid=3D718&gro=
up_id=3D54&atid=3D291
>=20
> Please read and comment. I just decided to let ocamlfind decide the
> destdir. You can use ocamlfind env var to override this.

I'm doing this already, and it works well. Nevertheless, there are some
remaining destdir problems, e.g. when executables are installed in the
wrong place.

I guess this is difficult to enforce technically (unless you use
something like the Gentoo sandbox, but this is very non-portable).

>  Although, since the problem appears even with findlib guru, I am
> willing to fix the bug to take into account DESTDIR everywhere.
>=20
> - missing QA
>=20
> That is a work in progress. I setup a jenkins instance in order to run
> QA test (http://deci.ovh.le-gall.net:8080/). If you have some basic
> configuration for that, feel free to contact me.

Good to hear that. I've also plans to include the oasis packages into my
autobuilder.

Btw, some of the issues can be easily caught at package upload time.
E.g. I've seen a number of tarballs which weren't properly
gzip-compressed. Others did not contain an _oasis file, or it was not
parseable.

>=20
> Although, here are my idea concerning the topic
>=20
> - we should always run "oasis setup" before building. This will
> enforce having the latest setup.ml generated and not some random old
> piece of code. I made a lot of effort to be able to have backward
> compatibility on _oasis (i.e supporting OASISFormat: 0.2 and 0.3), let
> take advantage of this

Ok, I can make this the default.

>=20
> - where can I find the specific code to handle oasis + GODI. I would
> like to have a closer look.

It's a bit spread over several repositories:

The script to convert an OASIS tarball to a GODI Makefile is here:
https://godirepo.camlcity.org/wwwsvn/godi-tools/trunk/console-src/godi_oasi=
s_import?rev=3D1120&root=3Dgodi-bootstrap&view=3Dauto

In order to convert findlib names to GODI packages, it uses a web
service (similar to the one we agreed upon some time ago, but I modified
it):

https://godirepo.camlcity.org/openapps/autoquery.cgi?q=3Dfindlib&l=3D<findl=
ibname>

It returns possible resolutions from both the autobuilder, and from my
OASIS scan (section=3D"oasis-import"). This CGI is quite boring:

https://godirepo.camlcity.org/wwwsvn/trunk/src/autobuild/autoquery.ml?rev=
=3D221&root=3Dapp-camlcityd&view=3Dauto

It only takes the data from a prepared db table. The OASIS data is put
into this table with this program:

https://godirepo.camlcity.org/wwwsvn/trunk/src/autobuild/import_oasisdb.ml?=
rev=3D217&root=3Dapp-camlcityd&view=3Dauto

For most of its work, it uses the official API. The API does not return
the findlib libraries, though, but they are shown on the webpage, so I
get the libraries from there (i.e. Could you include the libs in API
0.2?)

Gerd




>=20
>=20
> Regards
>=20
> Sylvain Le Gall
>=20
> > Gerd
> > --=20
> > ------------------------------------------------------------
> > Gerd Stolpmann, Darmstadt, Germany    gerd@gerd-stolpmann.de
> > Creator of GODI and camlcity.org.
> > Contact details:        http://www.camlcity.org/contact.html
> > Company homepage:       http://www.gerd-stolpmann.de
> > ------------------------------------------------------------
> > _______________________________________________
> > Godi-list mailing list
> > Godi-list@ocaml-programming.de
> > https://godirepo.camlcity.org/mailman/listinfo/godi-list
>=20
>=20

--=20
------------------------------------------------------------
Gerd Stolpmann, Darmstadt, Germany    gerd@gerd-stolpmann.de
Creator of GODI and camlcity.org.
Contact details:        http://www.camlcity.org/contact.html
Company homepage:       http://www.gerd-stolpmann.de
*** Searching for new projects! Need consulting for system
*** programming in Ocaml? Gerd Stolpmann can help you.
------------------------------------------------------------

