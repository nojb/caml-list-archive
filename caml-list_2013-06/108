Return-Path: <dra-news@metastack.com>
X-Original-To: caml-list@sympa.inria.fr
Delivered-To: caml-list@sympa.inria.fr
Received: from mail2-relais-roc.national.inria.fr (mail2-relais-roc.national.inria.fr [192.134.164.83])
	by sympa.inria.fr (Postfix) with ESMTPS id A359981792
	for <caml-list@sympa.inria.fr>; Wed, 19 Jun 2013 16:35:11 +0200 (CEST)
Received-SPF: None (mail2-smtp-roc.national.inria.fr: no sender
  authenticity information available from domain of
  dra-news@metastack.com) identity=pra;
  client-ip=81.103.221.49;
  receiver=mail2-smtp-roc.national.inria.fr;
  envelope-from="dra-news@metastack.com";
  x-sender="dra-news@metastack.com";
  x-conformance=sidf_compatible
Received-SPF: Neutral (mail2-smtp-roc.national.inria.fr: domain
  of dra-news@metastack.com does not assert whether or not
  81.103.221.49 is permitted sender) identity=mailfrom;
  client-ip=81.103.221.49;
  receiver=mail2-smtp-roc.national.inria.fr;
  envelope-from="dra-news@metastack.com";
  x-sender="dra-news@metastack.com";
  x-conformance=sidf_compatible; x-record-type="v=spf1"
Received-SPF: None (mail2-smtp-roc.national.inria.fr: no sender
  authenticity information available from domain of
  postmaster@mtaout03-winn.ispmail.ntl.com) identity=helo;
  client-ip=81.103.221.49;
  receiver=mail2-smtp-roc.national.inria.fr;
  envelope-from="dra-news@metastack.com";
  x-sender="postmaster@mtaout03-winn.ispmail.ntl.com";
  x-conformance=sidf_compatible
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: ApgAAKnAwVFRZ90xlGdsb2JhbABagzrAZBYOAQEBAQcNCQkUAyWCKggCHhIxGwUWUiMNAQ4BBB4FiAKbEqBAjgoThQ0Djm6JfJMrgWcCHg
X-IPAS-Result: ApgAAKnAwVFRZ90xlGdsb2JhbABagzrAZBYOAQEBAQcNCQkUAyWCKggCHhIxGwUWUiMNAQ4BBB4FiAKbEqBAjgoThQ0Djm6JfJMrgWcCHg
X-IronPort-AV: E=Sophos;i="4.87,896,1363129200"; 
   d="scan'208";a="22514752"
Received: from mtaout03-winn.ispmail.ntl.com ([81.103.221.49])
  by mail2-smtp-roc.national.inria.fr with ESMTP; 19 Jun 2013 16:35:11 +0200
Received: from aamtaout01-winn.ispmail.ntl.com ([81.103.221.35])
          by mtaout03-winn.ispmail.ntl.com
          (InterMail vM.7.08.04.00 201-2186-134-20080326) with ESMTP
          id <20130619143509.HPXW27949.mtaout03-winn.ispmail.ntl.com@aamtaout01-winn.ispmail.ntl.com>
          for <caml-list@inria.fr>; Wed, 19 Jun 2013 15:35:09 +0100
Received: from romulus.metastack.com ([81.102.132.77])
          by aamtaout01-winn.ispmail.ntl.com
          (InterMail vG.3.00.04.00 201-2196-133-20080908) with ESMTP
          id <20130619143509.PHQB27539.aamtaout01-winn.ispmail.ntl.com@romulus.metastack.com>
          for <caml-list@inria.fr>; Wed, 19 Jun 2013 15:35:09 +0100
Received: from Altus ([172.16.0.18])
	(authenticated bits=0)
	by romulus.metastack.com (8.14.2/8.14.2) with ESMTP id r5JEZ6nb013798
	(version=TLSv1/SSLv3 cipher=AES128-SHA bits=128 verify=NO)
	for <caml-list@inria.fr>; Wed, 19 Jun 2013 15:35:07 +0100
From: "David Allsopp" <dra-news@metastack.com>
To: "OCaml List" <caml-list@inria.fr>
Date: Wed, 19 Jun 2013 15:36:30 +0100
Organization: MetaStack Solutions Ltd.
Message-ID: <004c01ce6cfa$63423430$29c69c90$@metastack.com>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Outlook 14.0
Thread-Index: Ac5s+iyPfwm3L9DjTCuM7tRgn5aY7Q==
Content-Language: en-gb
X-Scanned-By: MIMEDefang 2.65 on 172.16.0.20
X-Cloudmark-Analysis: v=1.1 cv=GaEGOwq9FwezmTggA+b6yC6zDZF2HYaK6RN/tSqdnVA= c=1 sm=0 a=S_NuihaANbgA:10 a=cTs9vV391PwA:10 a=RQQLJnld3ZcA:10 a=kj9zAlcOel0A:10 a=KrEpQ8A4aCP8HoJ24Y4A:9 a=CjuIK1q_8ugA:10 a=HpAAvcLHHh0Zw7uRqdWCyQ==:117
Subject: [Caml-list] Building pcre-ocaml 7.0.2 on MinGW

It's been a while since I refreshed my OCaml installation from 3.12.1 but
having discovered that GADTs may really be the best thing since sliced
bread, I've been upgrading all my OCaml packages on Windows.

I'd noticed when I last refreshed (pcre-ocaml 6.2.5 / pcre 8.21) that pcre
8.21 no longer built under Windows but on that occasion I was lazy and stuck
with pcre 8.12 as that did build. This time, I've managed to get pcre 8.33
and pcre-ocaml 7.0.2 compiled under MinGW (32-bit) but with some very hacky
effort required.

Wondering if anyone else has succeeded doing this and whether there are any
GNU autotools experts here who might be able to provide pointers to the
weird problem with libtool before I brave posting to the autotools list! :o)

(Background: Windows Vista VM running Cygwin 1.7.20, GCC 4.5.3)
Configured PCRE with:
./configure --prefix="C:/Dev/OCaml" --includedir="C:/Dev/OCaml/lib"
--disable-cpp --enable-utf8 --host=i686-w64-mingw32 --build=mingw32

At this point, make all will freeze (completely crashes the terminal) when
it gets to libpcre.la. The same goes for PCRE 8.13, 8.20 and 8.21. A limited
comparison of the sources suggests that the issue is with libtool. The
workaround I've used is to configure PCRE 8.12 with the same switches and
then overwrite the libtool script in PCRE 8.33 with the one generated by
PCRE 8.12's configure. PCRE 8.12 is built with autoconf 2.65 where 8.33 is
built with autoconf 2.68 (I tried installing autoconf 2.65 and regenerating
the configure script in 8.33 but that didn't work either).

Having built PCRE 8.33 and installed it, it's necessary to produce a wrapper
.cmd file for pcre-config so that ocaml setup.ml -build works for pcre-ocaml
7.0.2 as unfortunately it's now using ocamlbuild rather than make (which
could use pcre-config directly).

With both of those shims in place, it does seem to be working - but has
anyone else been trying or experienced trouble building PCRE on Windows
since version 8.12? I haven't got the first clue how to debug libtool...


David

