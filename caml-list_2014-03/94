Return-Path: <rich@annexia.org>
X-Original-To: caml-list@sympa.inria.fr
Delivered-To: caml-list@sympa.inria.fr
Received: from mail3-relais-sop.national.inria.fr (mail3-relais-sop.national.inria.fr [192.134.164.104])
	by sympa.inria.fr (Postfix) with ESMTPS id 945A17F89E
	for <caml-list@sympa.inria.fr>; Sat, 22 Mar 2014 13:24:05 +0100 (CET)
Received-SPF: None (mail3-smtp-sop.national.inria.fr: no sender
  authenticity information available from domain of
  rich@annexia.org) identity=pra; client-ip=80.68.91.176;
  receiver=mail3-smtp-sop.national.inria.fr;
  envelope-from="rich@annexia.org";
  x-sender="rich@annexia.org"; x-conformance=sidf_compatible
Received-SPF: Pass (mail3-smtp-sop.national.inria.fr: domain of
  rich@annexia.org designates 80.68.91.176 as permitted sender)
  identity=mailfrom; client-ip=80.68.91.176;
  receiver=mail3-smtp-sop.national.inria.fr;
  envelope-from="rich@annexia.org";
  x-sender="rich@annexia.org"; x-conformance=sidf_compatible;
  x-record-type="v=spf1"
Received-SPF: None (mail3-smtp-sop.national.inria.fr: no sender
  authenticity information available from domain of
  postmaster@furbychan.cocan.org) identity=helo;
  client-ip=80.68.91.176;
  receiver=mail3-smtp-sop.national.inria.fr;
  envelope-from="rich@annexia.org";
  x-sender="postmaster@furbychan.cocan.org";
  x-conformance=sidf_compatible
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: AmgJAKGALVNQRFuw/2dsb2JhbABZgwY7qi2CLJZpgRYWdIIlAQEBAwE6NAsFCwsYCQQPEg8FKAkYJYdTAwkMAQjGfwOHFheGAIhvB4MkgRQEmEmBM5B/gy09
X-IPAS-Result: AmgJAKGALVNQRFuw/2dsb2JhbABZgwY7qi2CLJZpgRYWdIIlAQEBAwE6NAsFCwsYCQQPEg8FKAkYJYdTAwkMAQjGfwOHFheGAIhvB4MkgRQEmEmBM5B/gy09
X-IronPort-AV: E=Sophos;i="4.97,709,1389740400"; 
   d="scan'208";a="53678615"
Received: from furbychan.cocan.org ([80.68.91.176])
  by mail3-smtp-sop.national.inria.fr with ESMTP/TLS/DHE-RSA-AES128-SHA; 22 Mar 2014 13:24:03 +0100
Received: from rich by furbychan.cocan.org with local (Exim 4.80)
	(envelope-from <rich@annexia.org>)
	id 1WRKy0-0001Mh-EK; Sat, 22 Mar 2014 12:24:00 +0000
Date: Sat, 22 Mar 2014 12:24:00 +0000
From: "Richard W.M. Jones" <rich@annexia.org>
To: Normand <normand@linux.vnet.ibm.com>
Cc: caml-list@inria.fr
Message-ID: <20140322122400.GD10374@annexia.org>
References: <532B0EFD.9070606@linux.vnet.ibm.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <532B0EFD.9070606@linux.vnet.ibm.com>
User-Agent: Mutt/1.5.21 (2010-09-15)
Subject: Re: [Caml-list] need help to investigate an ocaml build error on
 ppc64le archi

On Thu, Mar 20, 2014 at 04:53:33PM +0100, Normand wrote:
> Hello there,
> I am trying to investigate a failure while porting ocaml on ppc64le archi (flag1)
> This is most probably related to some changes I did not made yet.
> But because I do not understand anything about ocaml I do not know where to search.
> 
> I understand that the bad unix.o is generated by the call to ocamlcompopt.sh
> calling itself ocamlrun with the parameters of flag2.
> 
> But I do not understand what archi specific files are used by this command line.
> 
> I would appreciate any suggestion on the subject.

ocamlcompopt.sh is a shell script wrapper around ocamlopt which is
just used within the OCaml build system (so we can run the compiler
we've just compiled).

The first thing to do is to add the -verbose option to those commands
(run them by hand).  That will print the 'as' and 'gcc' subcommands
that ocamlopt is running.

Rich.

> flag1: the original failure log extract.
> ===
> make[2]: Entering directory `/home/michel/rpmbuild/BUILD/ocaml-4.01.0/otherlibs/unix'
> ../../ocamlcompopt.sh -c -w +33..39 -warn-error A -g -nolabels unix.ml
> ../../ocamlcompopt.sh -c -w +33..39 -warn-error A -g -nolabels unixLabels.ml
> ../../boot/ocamlrun ../../tools/ocamlmklib -o unix -oc unix -ocamlopt '../../ocamlcompopt.sh' -linkall \
>           unix.cmx unixLabels.cmx
> ../../ocamlcompopt.sh -shared -o unix.cmxs -I . unix.cmxa
> /usr/bin/ld: unix.cmxs.startup.o: ABI version 1 is not compatible with ABI version 2 output
> /usr/bin/ld: failed to merge target specific data of file unix.cmxs.startup.o
> /usr/bin/ld: unix.a(unix.o): ABI version 1 is not compatible with ABI version 2 output
> /usr/bin/ld: failed to merge target specific data of file unix.a(unix.o)
> /usr/bin/ld: unix.a(unixLabels.o): ABI version 1 is not compatible with ABI version 2 output
> /usr/bin/ld: failed to merge target specific data of file unix.a(unixLabels.o)
> collect2: error: ld returned 1 exit status
> ===
> 
> flag2: unix.o generated from unix.ml
> ===
> + exec ../../boot/ocamlrun ../../ocamlopt -nostdlib -I ../../stdlib -c -w +33..39 -warn-error A -g -nolabels unix.ml
> ===
> $file unix.ml
> unix.ml: Mathematica 3.0 notebook
> ===
> $readelf -h unix.o |grep Flags
>    Flags:                             0x0
> ===
> 
> no full log because too big for attachment in ML
> 
> -- 
> Michel Normand
> 
> 
> -- 
> Caml-list mailing list.  Subscription management and archives:
> https://sympa.inria.fr/sympa/arc/caml-list
> Beginner's list: http://groups.yahoo.com/group/ocaml_beginners
> Bug reports: http://caml.inria.fr/bin/caml-bugs

-- 
Richard Jones
Red Hat
