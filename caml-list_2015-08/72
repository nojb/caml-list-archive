Return-Path: <gabriel.scherer@gmail.com>
X-Original-To: caml-list@sympa.inria.fr
Delivered-To: caml-list@sympa.inria.fr
Received: from mail3-relais-sop.national.inria.fr (mail3-relais-sop.national.inria.fr [192.134.164.104])
	by sympa.inria.fr (Postfix) with ESMTPS id F0EAD7EEBF
	for <caml-list@sympa.inria.fr>; Sat,  8 Aug 2015 09:38:22 +0200 (CEST)
Received-SPF: None (mail3-smtp-sop.national.inria.fr: no sender
  authenticity information available from domain of
  gabriel.scherer@gmail.com) identity=pra;
  client-ip=209.85.213.173;
  receiver=mail3-smtp-sop.national.inria.fr;
  envelope-from="gabriel.scherer@gmail.com";
  x-sender="gabriel.scherer@gmail.com";
  x-conformance=sidf_compatible
Received-SPF: Pass (mail3-smtp-sop.national.inria.fr: domain of
  gabriel.scherer@gmail.com designates 209.85.213.173 as
  permitted sender) identity=mailfrom;
  client-ip=209.85.213.173;
  receiver=mail3-smtp-sop.national.inria.fr;
  envelope-from="gabriel.scherer@gmail.com";
  x-sender="gabriel.scherer@gmail.com";
  x-conformance=sidf_compatible; x-record-type="v=spf1"
Received-SPF: None (mail3-smtp-sop.national.inria.fr: no sender
  authenticity information available from domain of
  postmaster@mail-ig0-f173.google.com) identity=helo;
  client-ip=209.85.213.173;
  receiver=mail3-smtp-sop.national.inria.fr;
  envelope-from="gabriel.scherer@gmail.com";
  x-sender="postmaster@mail-ig0-f173.google.com";
  x-conformance=sidf_compatible
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: A0CPAQAAscVVm63VVdFbgzo1aQaDHqoekXiFeQKBIwdMAQEBAQEBEgEBAQEBBgsLCSEuhCQBAQMBEhEdARsdAQMMBgUEBzcCAiEBAREBBQEcBhMih3YBAwoIDalZgS4+MYs/gWyCeYsbChknDVeEVQEBAQEBBQEBAQEBAQEVAQUOi0GCT4I2BAeCaYFDBZULhQGFdIFsgUlGkDsKg0OCGhIjgRcXhA48MYJMAQEB
X-IPAS-Result: A0CPAQAAscVVm63VVdFbgzo1aQaDHqoekXiFeQKBIwdMAQEBAQEBEgEBAQEBBgsLCSEuhCQBAQMBEhEdARsdAQMMBgUEBzcCAiEBAREBBQEcBhMih3YBAwoIDalZgS4+MYs/gWyCeYsbChknDVeEVQEBAQEBBQEBAQEBAQEVAQUOi0GCT4I2BAeCaYFDBZULhQGFdIFsgUlGkDsKg0OCGhIjgRcXhA48MYJMAQEB
X-IronPort-AV: E=Sophos;i="5.15,633,1432591200"; 
   d="scan'208";a="142312133"
Received: from mail-ig0-f173.google.com ([209.85.213.173])
  by mail3-smtp-sop.national.inria.fr with ESMTP/TLS/RC4-SHA; 08 Aug 2015 09:38:21 +0200
Received: by igbpg9 with SMTP id pg9so44097955igb.0;
        Sat, 08 Aug 2015 00:38:20 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20120113;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :cc:content-type;
        bh=uUyRpEIGbKTjR268OCNJedJ3eGmVnXjRZPRCO4N+mjI=;
        b=e0x+CqiuBQpOkjESq2DbBdTASFC6rUfo39KRkqifgguhY+BzUs5job8B/Po/KrnFCe
         RqcAr7gCkLITxFGY68mtGK4B2eXe451w/AD1WZ+rhcqMfvqdwOFDem3gJxVYE7TzQ72R
         h8SC4MS3skFTtDVIcVozP1Nr+NVCd0sCccWMiNxsSEL0a2eHm8tIBD3inE2FTzmmEzUv
         zn6iYyKICvRcEENBttffwRG/QnWhrMXowpKpAEBAXpkbqS++JLkRphbMDOOElLKsDfKe
         McyXE0eIsDeeSb1f390DYwpAAblEKvSsT2IdxRYoJOfI675C1oYS6Vai3if0mHsdPUJa
         +5HQ==
X-Received: by 10.50.128.169 with SMTP id np9mr2121861igb.37.1439019500660;
 Sat, 08 Aug 2015 00:38:20 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.79.68.132 with HTTP; Sat, 8 Aug 2015 00:37:41 -0700 (PDT)
In-Reply-To: <CANcqPu7JpBh_rx97Tv3ijz4EaMVuLLnghM-bduA33BBDOejoLg@mail.gmail.com>
References: <CANcqPu7JpBh_rx97Tv3ijz4EaMVuLLnghM-bduA33BBDOejoLg@mail.gmail.com>
From: Gabriel Scherer <gabriel.scherer@gmail.com>
Date: Sat, 8 Aug 2015 09:37:41 +0200
Message-ID: <CAPFanBHTonhSZC+L2w2PfRc6hd2t=Kd2-V-QeOtxYtaOKMzj0A@mail.gmail.com>
To: Bob Zhang <bobzhang1988@gmail.com>
Cc: Caml List <caml-list@inria.fr>, Xavier Leroy <Xavier.Leroy@inria.fr>
Content-Type: multipart/alternative; boundary=047d7b10ca83296ee1051cc7d6ea
Subject: Re: [Caml-list] Questions about changing lambda IR

--047d7b10ca83296ee1051cc7d6ea
Content-Type: text/plain; charset=UTF-8

You need to run "make bootstrap" to avoid having part of the definition
compiled against the stale definition of lambda.cmi. (I just checked that
it works on your change: after a bootrsap, "make world", "make opt", "make
opt.opt" work.)

On Sat, Aug 8, 2015 at 5:50 AM, Bob Zhang <bobzhang1988@gmail.com> wrote:

>
> Dear caml develpers,
>
>    I am working on an experimental branch to pass more information from
> typedtree to lambda to enable ocaml generate user readable javascript code(
> https://github.com/bobzhang/ocaml/tree/master) (online-demo:
> http://zhanghongbo.me/js-demo/)
>
>    Here I get a segfault, after I change const_block:
>    Below is my minimal change:
>
> ```
> type pointer_info =
>   | NullConstructor of string
>   | NullVariant of string
>   | NAPointer
>
> type tag_info =
>   | Constructor of string
>   | Tuple
>   | Variant of string
>   | Record
>   | NA
>
> type structured_constant =
>     Const_base of constant
>   | Const_pointer of int * pointer_info
>   | Const_block of int * tag_info * structured_constant list
>   | Const_float_array of string list
>   | Const_immstring of string
> ```
> Note that the enriched info is not used in ``emitcode``, now I get a
> segfault in make world:
>
> ```
> ../../boot/ocamlrun ../../ocamlc -nostdlib -I ../../stdlib -c -w +33..39
> -warn-error A -bin-annot -g -safe-string -I ../../stdlib -I ../../utils -I
> ../../typing -I ../../bytecomp -I ../../asmcomp extract_crc.ml
> ../../boot/ocamlrun ../../ocamlc -nostdlib -I ../../stdlib -o extract_crc
> dynlink.cma extract_crc.cmo
> make[3]: *** [extract_crc] Segmentation fault: 11
> make[3]: *** Deleting file `extract_crc'
> make[2]: *** [otherlibraries] Error 2
> make[1]: *** [all] Error 2
> ```
>
> Any help is appreciated : )
>
> --
> Regards
> -- Hongbo Zhang
>

--047d7b10ca83296ee1051cc7d6ea
Content-Type: text/html; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr">You need to run &quot;make bootstrap&quot; to avoid having=
 part of the definition compiled against the stale definition of lambda.cmi=
. (I just checked that it works on your change: after a bootrsap, &quot;mak=
e world&quot;, &quot;make opt&quot;, &quot;make opt.opt&quot; work.)<br></d=
iv><div class=3D"gmail_extra"><br><div class=3D"gmail_quote">On Sat, Aug 8,=
 2015 at 5:50 AM, Bob Zhang <span dir=3D"ltr">&lt;<a href=3D"mailto:bobzhan=
g1988@gmail.com" target=3D"_blank">bobzhang1988@gmail.com</a>&gt;</span> wr=
ote:<br><blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border=
-left:1px #ccc solid;padding-left:1ex"><div dir=3D"ltr"><br clear=3D"all"><=
div>Dear caml develpers,<br><br>=C2=A0 =C2=A0I am working on an experimenta=
l branch to pass more information from typedtree to lambda to enable ocaml =
generate user readable javascript code(<a href=3D"https://github.com/bobzha=
ng/ocaml/tree/master" target=3D"_blank">https://github.com/bobzhang/ocaml/t=
ree/master</a>) (online-demo: <a href=3D"http://zhanghongbo.me/js-demo/" ta=
rget=3D"_blank">http://zhanghongbo.me/js-demo/</a>)</div><div><br></div><di=
v>=C2=A0 =C2=A0Here I get a segfault, after I change const_block:</div><div=
>=C2=A0 =C2=A0Below is my minimal change:</div><div><br></div><div>```</div=
><div>type pointer_info =3D=C2=A0</div><div>=C2=A0 | NullConstructor of str=
ing</div><div>=C2=A0 | NullVariant of string=C2=A0</div><div>=C2=A0 | NAPoi=
nter=C2=A0</div><div><div><br></div><div>type tag_info =3D=C2=A0</div><div>=
=C2=A0 | Constructor of string</div><div>=C2=A0 | Tuple</div><div>=C2=A0 | =
Variant of string=C2=A0</div><div>=C2=A0 | Record=C2=A0</div><div>=C2=A0 | =
NA</div></div><div><br></div><div>type structured_constant =3D</div><div>=
=C2=A0 =C2=A0 Const_base of constant</div><div>=C2=A0 | Const_pointer of in=
t * pointer_info</div><div>=C2=A0 | Const_block of int * tag_info * structu=
red_constant list</div><div>=C2=A0 | Const_float_array of string list</div>=
<div>=C2=A0 | Const_immstring of string</div><div>```</div><div>Note that t=
he enriched info is not used in ``emitcode``, now I get a segfault in make =
world:</div><div><br></div><div>```</div><div><div>../../boot/ocamlrun ../.=
./ocamlc -nostdlib -I ../../stdlib -c -w +33..39 -warn-error A -bin-annot -=
g -safe-string -I ../../stdlib -I ../../utils -I ../../typing -I ../../byte=
comp -I ../../asmcomp <a href=3D"http://extract_crc.ml" target=3D"_blank">e=
xtract_crc.ml</a></div><div>../../boot/ocamlrun ../../ocamlc -nostdlib -I .=
./../stdlib -o extract_crc dynlink.cma extract_crc.cmo</div><div>make[3]: *=
** [extract_crc] Segmentation fault: 11</div><div>make[3]: *** Deleting fil=
e `extract_crc&#39;</div><div>make[2]: *** [otherlibraries] Error 2</div><d=
iv>make[1]: *** [all] Error 2</div></div><div>```</div><div><br></div><div>=
Any help is appreciated : )</div><span class=3D"HOEnZb"><font color=3D"#888=
888"><div><br></div>-- <br><div>Regards<br>-- Hongbo Zhang</div>
</font></span></div>
</blockquote></div><br></div>

--047d7b10ca83296ee1051cc7d6ea--
