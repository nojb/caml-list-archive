Return-Path: <dra-news@metastack.com>
X-Original-To: caml-list@sympa.inria.fr
Delivered-To: caml-list@sympa.inria.fr
Received: from mail2-relais-roc.national.inria.fr (mail2-relais-roc.national.inria.fr [192.134.164.83])
	by sympa.inria.fr (Postfix) with ESMTPS id 180BF7ED25
	for <caml-list@sympa.inria.fr>; Mon, 15 Jul 2013 14:21:27 +0200 (CEST)
Received-SPF: None (mail2-smtp-roc.national.inria.fr: no sender
  authenticity information available from domain of
  dra-news@metastack.com) identity=pra;
  client-ip=81.103.221.49;
  receiver=mail2-smtp-roc.national.inria.fr;
  envelope-from="dra-news@metastack.com";
  x-sender="dra-news@metastack.com";
  x-conformance=sidf_compatible
Received-SPF: Neutral (mail2-smtp-roc.national.inria.fr: domain
  of dra-news@metastack.com does not assert whether or not
  81.103.221.49 is permitted sender) identity=mailfrom;
  client-ip=81.103.221.49;
  receiver=mail2-smtp-roc.national.inria.fr;
  envelope-from="dra-news@metastack.com";
  x-sender="dra-news@metastack.com";
  x-conformance=sidf_compatible; x-record-type="v=spf1"
Received-SPF: None (mail2-smtp-roc.national.inria.fr: no sender
  authenticity information available from domain of
  postmaster@mtaout03-winn.ispmail.ntl.com) identity=helo;
  client-ip=81.103.221.49;
  receiver=mail2-smtp-roc.national.inria.fr;
  envelope-from="dra-news@metastack.com";
  x-sender="postmaster@mtaout03-winn.ispmail.ntl.com";
  x-conformance=sidf_compatible
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: AsoAABDo41FRZ90xlGdsb2JhbABagmVVT8FSgQ8WDgEBAQEHDQkJFAMlgiMBAQEDATpECwIBCBgKFBAyFwENAgQbiAIHAwi1MI8zOIMLbQOXXIEpkzaCKA
X-IPAS-Result: AsoAABDo41FRZ90xlGdsb2JhbABagmVVT8FSgQ8WDgEBAQEHDQkJFAMlgiMBAQEDATpECwIBCBgKFBAyFwENAgQbiAIHAwi1MI8zOIMLbQOXXIEpkzaCKA
X-IronPort-AV: E=Sophos;i="4.89,668,1367964000"; 
   d="scan'208";a="26049667"
Received: from mtaout03-winn.ispmail.ntl.com ([81.103.221.49])
  by mail2-smtp-roc.national.inria.fr with ESMTP; 15 Jul 2013 14:21:26 +0200
Received: from aamtaout02-winn.ispmail.ntl.com ([81.103.221.35])
          by mtaout03-winn.ispmail.ntl.com
          (InterMail vM.7.08.04.00 201-2186-134-20080326) with ESMTP
          id <20130715122125.ROE27949.mtaout03-winn.ispmail.ntl.com@aamtaout02-winn.ispmail.ntl.com>
          for <caml-list@inria.fr>; Mon, 15 Jul 2013 13:21:25 +0100
Received: from romulus.metastack.com ([81.102.132.77])
          by aamtaout02-winn.ispmail.ntl.com
          (InterMail vG.3.00.04.00 201-2196-133-20080908) with ESMTP
          id <20130715122125.ZKPF6472.aamtaout02-winn.ispmail.ntl.com@romulus.metastack.com>
          for <caml-list@inria.fr>; Mon, 15 Jul 2013 13:21:25 +0100
Received: from remus.metastack.local (remus.metastack.com [172.16.0.1])
	by romulus.metastack.com (8.14.2/8.14.2) with ESMTP id r6FCLNsO016776
	(version=TLSv1/SSLv3 cipher=AES128-SHA bits=128 verify=FAIL)
	for <caml-list@inria.fr>; Mon, 15 Jul 2013 13:21:23 +0100
Received: from Remus.metastack.local ([fe80::547c:3c42:e1da:eda2]) by
 Remus.metastack.local ([fe80::547c:3c42:e1da:eda2%10]) with mapi id
 14.03.0123.003; Mon, 15 Jul 2013 13:21:22 +0100
From: David Allsopp <dra-news@metastack.com>
To: "caml-list@inria.fr" <caml-list@inria.fr>
Thread-Topic: [Caml-list] OCaml installer on Windows no longer installs
 MinGW?
Thread-Index: AQHOgVScW79oFgV0pUeCbRljHdkpJZllqCEw
Date: Mon, 15 Jul 2013 12:21:22 +0000
Message-ID: <E51C5B015DBD1348A1D85763337FB6D9CC91F268@Remus.metastack.local>
References: <51E3E70F.9010202@inria.fr>
In-Reply-To: <51E3E70F.9010202@inria.fr>
Accept-Language: en-GB, en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
x-originating-ip: [81.98.252.242]
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: quoted-printable
MIME-Version: 1.0
Organization: MetaStack Solutions Ltd.
X-Scanned-By: MIMEDefang 2.65 on 172.16.0.20
X-Cloudmark-Analysis: v=1.1 cv=GaEGOwq9FwezmTggA+b6yC6zDZF2HYaK6RN/tSqdnVA= c=1 sm=0 a=6ptMtq13tUYA:10 a=3Pm8Mq2MB1sA:10 a=cTs9vV391PwA:10 a=kj9zAlcOel0A:10 a=xqWC_Br6kY4A:10 a=jK3bGrtaAAAA:8 a=vQ7u1CqDCjSMjJ5-OPEA:9 a=CjuIK1q_8ugA:10 a=HpAAvcLHHh0Zw7uRqdWCyQ==:117
Subject: RE: [Caml-list] OCaml installer on Windows no longer installs
 MinGW?

Romain Bardou wrote:
> I just installed OCaml from http://protz.github.io/ocaml-installer/ on a
> fresh Windows 7 32bit installation, in VirtualBox, and run into several
> problems.

I haven't yet got around to trying this installer out, though I think it is=
 being actively maintained.

However...

> During Cryptokit compilation...
>=20
> - The configure step returned no error although it should have (see
> below).
>=20
> - It failed to compile because it could not find i686-w64-mingw32-gcc.
>   Apparently it was not installed by the OCaml installer.
>=20
> - I found no way to specify the GCC executable name during the "setup.ml -
> configure" step. Can OASIS handle this?

If correctly configured, you shouldn't need to do this - OCaml itself shoul=
d know it. I believe that OASIS compiles .c files the "correct" way (i.e. u=
sing ocamlopt which itself calls the correct gcc).

> - I installed the Cygwin packages mingw64-i686-gcc and mingw64-i686-
> headers myself.
>   Then, compiling Cryptokit failed: ocamlmklib raised End_of_file while
> trying to read libmoldname.a, which happens to be 8 bytes long.

I don't think it's related, but I use the following patch for Cryptokit (ba=
sed on info from Sylvain):

diff -Naur cryptokit-1.7/myocamlbuild.ml cryptokit-1.7/myocamlbuild.ml
--- cryptokit-1.7/myocamlbuild.ml	2011-06-23 18:57:04.000000000 +0100
+++ cryptokit-1.7/myocamlbuild.ml	2011-08-12 16:01:55.867588300 +0100
@@ -473,7 +473,7 @@
             [
                (OASISExpr.EBool true, S []);
                (OASISExpr.EFlag "zlib",
-                 S [A "-ccopt"; A "-O"; A "-ccopt"; A "-DHAVE_ZLIB"])
+                 S [A "-ccopt"; A "-O"; A "-ccopt"; A "-DHAVE_ZLIB"; A "-c=
copt"; A "-LC:/Dev/OCaml/lib"])
             ]);
           (["oasis_library_cryptokit_cclib"; "link"],
             [
@@ -483,7 +483,7 @@
           (["oasis_library_cryptokit_cclib"; "ocamlmklib"; "c"],
             [
                (OASISExpr.EBool true, S []);
-               (OASISExpr.EFlag "zlib", S [A "-lz"])
+               (OASISExpr.EFlag "zlib", S [A "-LC:/Dev/OCaml/lib"; A "-lz"=
])
             ])
        ];
      }

But that's simply to pass a link directory for zlib. With that patch, I hav=
e no problems running:

ocaml setup.ml -configure --enable-zlib
ocaml setup.ml -build
ocaml setup.ml -doc
ocaml setup.ml -install

And it does seem to work.

HTH,


David
