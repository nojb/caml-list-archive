Return-Path: <info@gerd-stolpmann.de>
X-Original-To: caml-list@sympa.inria.fr
Delivered-To: caml-list@sympa.inria.fr
Received: from mail2-relais-roc.national.inria.fr (mail2-relais-roc.national.inria.fr [192.134.164.83])
	by sympa.inria.fr (Postfix) with ESMTPS id E5C3B7EE49
	for <caml-list@sympa.inria.fr>; Fri, 20 Sep 2013 18:46:26 +0200 (CEST)
Received-SPF: None (mail2-smtp-roc.national.inria.fr: no sender
  authenticity information available from domain of
  info@gerd-stolpmann.de) identity=pra;
  client-ip=212.227.126.186;
  receiver=mail2-smtp-roc.national.inria.fr;
  envelope-from="info@gerd-stolpmann.de";
  x-sender="info@gerd-stolpmann.de";
  x-conformance=sidf_compatible
Received-SPF: None (mail2-smtp-roc.national.inria.fr: no sender
  authenticity information available from domain of
  info@gerd-stolpmann.de) identity=mailfrom;
  client-ip=212.227.126.186;
  receiver=mail2-smtp-roc.national.inria.fr;
  envelope-from="info@gerd-stolpmann.de";
  x-sender="info@gerd-stolpmann.de";
  x-conformance=sidf_compatible
Received-SPF: Pass (mail2-smtp-roc.national.inria.fr: domain of
  postmaster@moutng.kundenserver.de designates 212.227.126.186
  as permitted sender) identity=helo;
  client-ip=212.227.126.186;
  receiver=mail2-smtp-roc.national.inria.fr;
  envelope-from="info@gerd-stolpmann.de";
  x-sender="postmaster@moutng.kundenserver.de";
  x-conformance=sidf_compatible; x-record-type="v=spf1"
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: AuQBAF97PFLU4366lGdsb2JhbABBGoM/g3u+EIEaFg4BAQEBBwsLCRIqgiUBAQUjVhALDgQGFRUCAkkOBhMJiAAINqdwkjeJQoV9JgcKgl+BNQOOeooxhQKHe4Zw
X-IPAS-Result: AuQBAF97PFLU4366lGdsb2JhbABBGoM/g3u+EIEaFg4BAQEBBwsLCRIqgiUBAQUjVhALDgQGFRUCAkkOBhMJiAAINqdwkjeJQoV9JgcKgl+BNQOOeooxhQKHe4Zw
X-IronPort-AV: E=Sophos;i="4.90,945,1371074400"; 
   d="asc'?scan'208";a="33723181"
Received: from moutng.kundenserver.de ([212.227.126.186])
  by mail2-smtp-roc.national.inria.fr with ESMTP/TLS/RC4-SHA; 20 Sep 2013 18:46:25 +0200
Received: from office1.lan.sumadev.de (dslb-178-004-026-199.pools.arcor-ip.net [178.4.26.199])
	by mrelayeu.kundenserver.de (node=mreu3) with ESMTP (Nemesis)
	id 0MOpN4-1VI62Z1Ab0-00643c; Fri, 20 Sep 2013 18:46:25 +0200
Received: from [192.168.5.106] (dslb-178-004-026-199.pools.arcor-ip.net [178.4.26.199])
	by office1.lan.sumadev.de (Postfix) with ESMTPSA id E9F09C00CF;
	Fri, 20 Sep 2013 18:46:24 +0200 (CEST)
Message-ID: <1379695573.11824.39.camel@thinkpad>
From: Gerd Stolpmann <info@gerd-stolpmann.de>
To: Dwight Schauer <dschauer@gmail.com>
Cc: Gerd Stolpmann <info@gerd-stolpmann.de>, caml-list@inria.fr
Date: Fri, 20 Sep 2013 18:46:13 +0200
In-Reply-To: <CAKdt_-aRvGpXTnAC4T5QmLpi8d3FeC+zv9Rt4D56vAFiJr0QxA@mail.gmail.com>
References: 
	<CAKdt_-YTk2gfc6P2-jyLVzTbp7heueC+M3t=p_LJWaNMC_zR7Q@mail.gmail.com>
	 <1379692480.11824.28.camel@thinkpad>
	 <CAKdt_-aRvGpXTnAC4T5QmLpi8d3FeC+zv9Rt4D56vAFiJr0QxA@mail.gmail.com>
Content-Type: multipart/signed; micalg="pgp-sha1"; protocol="application/pgp-signature";
	boundary="=-csFEPh+JCdjXyoCSkB8g"
X-Mailer: Evolution 3.2.3-0ubuntu6 
Mime-Version: 1.0
X-Provags-ID: V02:K0:TpH0Rs8vu1RwnzsuU9SyghSrpFb0zQBYxtQZe+6mZr5
 jieii+weilbcilsTU22tEA5RQHWhqr6gpoF+86/tEM/9cyY7ZB
 TvOJIk9dW4hOKb+0eiubB6iXg1iaJhhdOgF+Vvd3HjJsmIrqOn
 gwTq5oSGXIG3WcJKoRImknHEmcUydEjYLigJG/77O7W28om6rE
 IjcWX/QcK6Qx+/ZsZBRFvjCfUZY6NgTFveY68JBSn3RsWCDjcG
 Id1y4gjpVDGlP2EuDjlRClOyZK6/UASG+n9ht0EqpIZBV61HPe
 HG9Tf7u/5Ok9dtk4V+HIp63e9rllF6AmBI4bQL8A9xUL25ZP7D
 kptJWwDyXqxNbQLaPSoGEKKddorB0DZb2jhu/pJH0
Subject: Re: [Caml-list] Ocaml on an embedded arm system (no linux)


--=-csFEPh+JCdjXyoCSkB8g
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: quoted-printable

Am Freitag, den 20.09.2013, 11:19 -0500 schrieb Dwight Schauer:
> No, the Flash/RAM sizes I mentioned are not a typo.
>=20
>=20
> OCaPIC is a similar OCaml project for PIC microntrollers.
> http://www.algo-prog.info/ocapic/web/index.php?id=3DOCAPIC:OCAPIC
>=20
>=20
> The microcontrollers targetted by OCaPIC have the following
> characteristics:
>   RAM memory: a few kB.
>   Flash memory: a few tens of kB.
>   Clock: a few MHz
>=20
>=20
> The ARM microcontrollers I'm looking to target are much bigger than
> PIC microcontrollers on all 3 of those counts are significantly
> larger.

Just looked at the slides. They implemented a lot of things to increase
the compactness (bytecode compression, 16 bit integers and pointers, a
simple stop-and-copy GC, a utility to remove dead code, ...). This is
essentially a complete port of ocaml to a new architecture, with heavy
modification of the runtime. At the end, it is possible to run programs
with a few hundred lines of code (which is really impressive). You
cannot run the toploop shell.

What you could do, of course, it to port OcaPIC to ARM (well, there is
some assembly code, but not that much). But this doesn't give you a
toploop, probably not even dynamic loading of bytecode.

I really wonder what makes these very small devices so interesting as
platform for OCaml (other than, of course, having fun to run some code
in the favorite language there).

Gerd



>=20
>=20
>=20
>=20
>=20
> On Fri, Sep 20, 2013 at 10:54 AM, Gerd Stolpmann
> <info@gerd-stolpmann.de> wrote:
>         Am Freitag, den 20.09.2013, 09:13 -0500 schrieb Dwight
>         Schauer:
>=20=20=20=20=20=20=20=20=20
>         > The ARM processors I'm looking to target are:
>         > STM32F407ZGT6 ARM Cortex-M4, 1MB Flash, 196KB RAM (Has
>         floating point)
>         > STM32F103RB ARM Cortex-M3, 128 KB Flash, 20K RAM (No
>         floating point)
>=20=20=20=20=20=20=20=20=20
>=20=20=20=20=20=20=20=20=20
>         I hope this isn't a typo. 196 KB RAM is way too low to even
>         run a hello
>         world program. The predecessor of ocaml, caml-light, needed
>         640K at
>         minimum for running it on DOS, and that was 16 bit code. Ocaml
>         is a lot
>         larger, and generates less dense 32 bit code.
>=20=20=20=20=20=20=20=20=20
>         For a very small app on bare metal, I think you need at least
>         4-8 MB of
>         memory. For making you happy, calculate 64 MB. I cannot say
>         much about
>         the split flash mem vs. RAM - but you should take into account
>         that the
>         representation of values isn't optimized for compactness, and
>         you also
>         need extra RAM to give the garbage collector room.
>=20=20=20=20=20=20=20=20=20
>         Maybe it is possible to lower the memory requirements by
>         modifying the
>         ocaml runtime (e.g. make the bytecode more compact at the cost
>         of extra
>         decoding steps, remove unneeded parts like the
>         compactor, ...), but I
>         doubt you'll be able to hit the mentioned limits.
>=20=20=20=20=20=20=20=20=20
>         Gerd
>=20=20=20=20=20=20=20=20=20
>=20=20=20=20=20=20=20=20=20
>         >
>         >
>         > On both I'd like to be able to run bytecode both out of
>         Flash and RAM.
>         > (Primarily flash, but RAM for debugging).
>         >
>         >
>         > Speed is on overly important as long as I can control when
>         the garbage
>         > collection is run (could be done in C in the multitasker?).
>         >
>         >
>         >
>         > Dwight
>         >
>         >
>=20=20=20=20=20=20=20=20=20
>=20=20=20=20=20=20=20=20=20
>         --
>         ------------------------------------------------------------
>         Gerd Stolpmann, Darmstadt, Germany    gerd@gerd-stolpmann.de
>         Creator of GODI and camlcity.org.
>         Contact details:        http://www.camlcity.org/contact.html
>         Company homepage:       http://www.gerd-stolpmann.de
>         ------------------------------------------------------------
>=20
>=20

--=20
------------------------------------------------------------
Gerd Stolpmann, Darmstadt, Germany    gerd@gerd-stolpmann.de
Creator of GODI and camlcity.org.
Contact details:        http://www.camlcity.org/contact.html
Company homepage:       http://www.gerd-stolpmann.de
------------------------------------------------------------

--=-csFEPh+JCdjXyoCSkB8g
Content-Type: application/pgp-signature; name="signature.asc"
Content-Description: This is a digitally signed message part
Content-Transfer-Encoding: 7bit

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.11 (GNU/Linux)

iQEcBAABAgAGBQJSPHvWAAoJEAaM4b9ZLB5T1MUH/jtnm/cU5STGGcdmstdGXPKm
noaYBobIT32Rc6YdxPCdpQAk34ZWJ1yhZtxieFrslZiLNpiXNbfDxCZdN9uVrLq5
qKIUkuDXQ0oL9ThRnWsqk8diZfyZVAmFt8BE4Esn9o46TDsZgU2KHl28xU2NqARI
jRcJ+aEa5oRrFnLUz/v+lWX594UedDJygYtTAfziZ04CrV1aHKhCAKTbVJk/Vuzk
VKCWyFk1F98b6kGAf7uUIurSx9zMWC4OI7fwIUZmrz0BJQvHWZfNz4+iJyiab4KN
ID96fz5fI1DFNDVQsPFwVyEcH6MPvoXP032baugm7aGWiGCS+Y39wcFTbot041k=
=VW+B
-----END PGP SIGNATURE-----

--=-csFEPh+JCdjXyoCSkB8g--

